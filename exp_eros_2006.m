%-----------------------------------------------------------------
% Galactic Bulge microlensing optical depth from EROS-2 Avril 2006
%-----------------------------------------------------------------

% Exposure Eros 2006
exposure = 18.1246 ; % page 8, formule 11


% ttobs=tau/(gam/1e6/365.25);
% disp(['<tobs> (en jours) = ' num2str(ttobs)]);
% N=gam*exposure;
% disp(['nb d''evt  = ' num2str(N)]);
% 
% taur=gam*pi/2*uT*mean(te)/365.25/1e6;
% taur=real(taur);
% disp(['tau (avec gamma integré par MC) = ' num2str(taur)]);
% 

%-----------------
%Evenements
%-----------------


teros2006 =[12.7800, 17.3540,   18.1810,   61.5400,   36.2330,   15.9670,   18.7750,   10.4580,   27.4290,   13.7080,   70.2130,   20.3560,   14.7280,    9.7050,   16.2900,  116.0990,   17.6720,   43.5050,   59.1710,   22.3880,   26.7600,   38.0980,   97.8530,   65.3950,   14.0340,   14.1040,   23.7620,   38.2010,   16.9540,   13.9410,   21.5130,   17.2090,  137.4820,   14.4830,   37.8200,   10.4240,   30.1190,    7.7040,    7.9120,   13.5500,   23.2860,   78.7280,   34.9320,   43.1480,   19.9940,   50.9820,   23.9980,   13.8240,   37.3730,   90.5890,   91.4180,   29.8650,    7.1400,   71.0900,   46.8720,   47.1000,   36.2630,   18.3170,   21.5680,   14.2860,   23.4960,   82.4680,   18.9320,  128.8440,   24.8320,   23.4930,    8.1760,   29.7630,   35.8870,   10.3480,   30.0170,   13.8320,   13.1590,   19.0320,   10.6230,   25.5010,   12.6160,   24.9270,   33.8100,   23.5280,   10.0300,   12.5180,   20.4670,    7.6280,   25.7690,   30.7260,    5.7750,   24.7380,   17.8780,   19.8990,   11.9740,   25.4770,   36.0590,  124.3650,   16.0900,   19.9040,   35.3980,   53.5740,   14.0640,    8.5740,    9.4660,   12.8640,   11.3750,   53.1050,   99.5040,   17.8360,   21.2800,   20.0120,   23.1190,   10.8710,   54.7970,   23.8030,   26.1670,   18.3870,   67.9400,    6.2700,   24.1600,   19.1730,  201.8820,  47.0000];
efferos2006= [ 0.5760,    0.5770,    0.7130,    0.8230,    0.8100,    0.5600,    0.6710,    0.4970,    0.7980,    0.7060,    0.8670,    0.7220,    0.6500,    0.4740,    0.6080,    0.6770,    0.5880,    0.6920,    0.7930,    0.6820,    0.7830,    0.9080,    0.8630,    0.7820,    0.5820,    0.5540,    0.7060,    0.4890,    0.8220,    0.7530,    0.7970,    0.7440,    0.9300,    0.7070,    0.9120,    0.5370,    0.8250,    0.4110,    0.4110,    0.6250,   0.6880,    0.9070,    0.8010,    0.8870,    0.8030,    0.9140,    0.7580,    0.5030,    0.7810,    0.9640,    0.9610,    0.8710,    0.3300,    0.8900,    0.5870,    0.9110,    0.9060,    0.7220,    0.8040,    0.7390,    0.7930,    0.9000,    0.7110,    0.8830,    0.8530,    0.8560,    0.4920,    0.8320,    0.8760,    0.5480,    0.8870,    0.6310,    0.6140,    0.7270,    0.2920,    0.5930,    0.5540,    0.5870,    0.6420,    0.6300,    0.4630,    0.5720,    0.6510,    0.3340,    0.7390,    0.5650,    0.2910,    0.7850,    0.6870,    0.6100,    0.4620,    0.6790,    0.5080,    0.7760,    0.5430,    0.7540,    0.7580,    0.8810,    0.5760,    0.4150,    0.4550,    0.5850,    0.5040,    0.8540,    0.8230,    0.6860,    0.6390,    0.7650,    0.5580,    0.3630,    0.7890,    0.7680,    0.8170,    0.7280,    0.8100,    0.2030,    0.7610,    0.6880,    0.8540,    0.8510];


%Données
teff = teros2006;
eff = efferos2006;

%-----------------------------------------------------------------------------------------------
% Interpolation lineaire de l'efficacite pour determiner la probabilite qu'un evt a d'etre garde
%-----------------------------------------------------------------------------------------------

tinterperos = teros2006;
effinterperos = efferos2006;

teffmaxe=max(tinterperos);
teffmine=min(tinterperos);

i1 = find((te<=teffmaxe)&(te>=teffmine));
i1blend = find((teblend<=teffmaxe)&(teblend>=teffmine));

effsimeros = zeros(1,length(te));	% applique une efficacite nulle aux durees superieures et inferieures
effsimerosblend = zeros(1,length(te));
effsimeros(i1) = interp1(tinterperos,effinterperos,te(i1));
effsimerosblend(i1blend) = interp1(tinterperos,effinterperos,teblend(i1blend));

%-----------------------------------------------------------------------------
% Tirage d'un nombre aleatoire qui servira a decider si l'evt est garde ou non
%-----------------------------------------------------------------------------

raeros = rand(1,length(te))*max(effinterperos);

%--------------------------------------------------------------------------------------------------------------------------
% compare le nombre aleatoire precedent a l'efficacite que l'on vient de calculer afin de decider si l'evt est garde ou non
%--------------------------------------------------------------------------------------------------------------------------

% On choisit l'efficacité ici en prenant les bons indices i

i = find(raeros-effsimeros<=0);

teobs = te(i);

ib = find(raeros-effsimerosblend<=0);

teobsblend = teblend(ib); % On récupère les éléments qui sont soumis au blending avec le calcul d'avant
